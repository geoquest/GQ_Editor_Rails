<%= render 'shared/header' %>

<%= render 'shared/mission_navigation' %>
<%= render 'shared/editor_control' %>

<%= javascript_include_tag "jquery-1.5.2"  %>
<%= javascript_include_tag "jquery-ui-1.8.12.custom.min" %>
<%= javascript_include_tag "jquery.jeditable" %>

<%= javascript_include_tag "commands/command" %>
<%= javascript_include_tag "commands/question_and_answer" %>
<%= javascript_include_tag "views/question_and_answer" %>

<!-- TODO:
questions="3"
correctAnswersNeeded="0"
-->

<script language="javascript" type="text/javascript">
var mission_id = "<%= @mission.attributes['id'] %>";
var project_id = "<%= @project.id %>";
</script>

<script>
$(function() {
    $( "#accordion" ).accordion({collapsible: true, animated: false, active: false});
});

$(document).ready(function() {
  $('.editable-question').editable(editQuestionText, {type: 'text'} );
  $('.editable-answer').editable(editAnswerText, { type: 'text'});
  $('.editable-onchoose').editable(editOnChooseText, {type : 'text'});
});


</script>

<div class="content">

Shuffle Questions:
<input type="checkbox" <%=
 if @mission.attributes['shuffle'] == "true"
   "checked"
 end
%> id="shuffle"/> <br />

<%
@introNode = XPath.first(@mission, "./intro")
@intro = @introNode.text unless @introNode.nil?

@outroSuccessNode = XPath.first(@mission, "./outroSuccess")
@outroSuccess = @outroSuccessNode.text unless @outroSuccessNode.nil?

@outroFailNode = XPath.first(@mission, "./outroFail")
@outroFail = @outroFailNode.text unless @outroFailNode.nil?

%>

<table>
  <tr>
    <td>Intro</td>
 <% if @introNode.nil? %>
    <td id="introPlace">  <input type="button" value="Add Intro" onclick="addIntro()" /> </td>
    <td id="introButtonPlace"></td>
 <% else %>
    <td id="introPlace">
        <textarea cols="30" rows="3"  id="intro"><%= @intro %></textarea>
    </td>
    <td id="introButtonPlace">
      <input type="button" value="Intro aktualisieren" onclick="updateIntro()"/> <br />
      <input type="button" value="Intro löschen" onclick="deleteIntro()" />
    </td>
 <% end %>
</tr>


  <tr>
    <td>Outro (Success)</td>
 <% if @outroSuccessNode.nil? %>
    <td id="outroSuccessPlace">  <input type="button" value="Add Outro (Success)" onclick="addOutroSuccess()" /> </td>
    <td id="outroSuccessButtonPlace"></td>
 <% else %>
    <td id="outroSuccessPlace">
        <textarea cols="30" rows="3"  id="outroSuccess"><%= @outroSuccess %></textarea>
    </td>
    <td id="outroSuccessButtonPlace">
      <input type="button" value="Outro (Success) aktualisieren" onclick="updateOutroSuccess()"/><br />
      <input type="button" value="Outro (Success) löschen" onclick="deleteOutroSuccess()" />
    </td>
 <% end %>
</tr>



  <tr>
    <td>Outro (Fail)</td>
 <% if @outroFailNode.nil? %>
    <td id="outroFailPlace">  <input type="button" value="Add Outro (Fail)" onclick="addOutroFail()" /> </td>
    <td id="outroFailButtonPlace"></td>
 <% else %>
    <td id="outroFailPlace">
        <textarea cols="30" rows="3"  id="outroFail"><%= @outroFail %></textarea>
    </td>
    <td id="outroFailButtonPlace">
      <input type="button" value="Outro (Fail) aktualisieren" onclick="updateOutroFail()"/><br />
      <input type="button" value="Outro (Fail) löschen" onclick="deleteOutroFail()" />
    </td>
 <% end %>
</tr>



</table>

<div id="accordion">
<% @questions.each do |question| %>
<h3><a href="#"><%= XPath.first(question, "./questiontext").text %></a></h3>
<div>

  Frage: <div class="editable-question"><%= XPath.first(question, "./questiontext").text %></div> <br />
  <input type="button" onclick="deleteQuestion()" value="Frage löschen" />
  <br />

  <table class="answerTable">
  <tr><td>Antwort</td><td>Reaktion</td></tr>
<% XPath.each(question, "./answer") do |answer| %>
  <tr>
    <td class="answerCell">
      <div class="editable-answer"> <%= answer.text %></div>
    </td>
    <td class="answerCell">
      <div class="editable-onchoose"> <%= answer.attributes['onChoose'] %></div>
    </td>
  </tr>
<% end %>
</table>
<p>Neue Antwort</p>
<textarea class="newAnswerTextfield" cols="30" rows="4"></textarea>
<p>Text, wenn diese Antwort gewählt wird</p>
<textarea class="newOnChooseTextfield" cols="30" rows="4"></textarea>

<br />

<input type="button" value="Antwort hinzufügen" onclick="addAnswer()" />
</div>

<% end %>
</div>


<hr />
Neue Frage: <br />
<textarea cols="30" rows="4" id="newQuestionText"></textarea>

<input type="button" value="Neue Frage hinzufügen" onclick="addQuestion()"/>
</div>